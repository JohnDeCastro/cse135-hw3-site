<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hello Data Viz</title>

  <!-- ZingChart CDN -->
  <script src="https://cdn.zingchart.com/zingchart.min.js"></script>

  <style>
    :root { --gap: 20px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 24px; background:#fafafa; }
    h1 { margin: 0 0 16px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: var(--gap); max-width: 1200px; margin: 0 auto; }
    @media (min-width: 900px) { .grid { grid-template-columns: 1fr 1fr; } }
    .card { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
    .title { font-weight: 600; margin: 0 0 8px; }
    .chart { width: 100%; height: 360px; }
    .full { grid-column: 1 / -1; }
    a { color: #2563eb; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header style="max-width:1200px;margin:0 auto 16px;">
    <h1>Hello Data Viz</h1>
    <p><a href="/">‚Üê Back to Home</a></p>
  </header>

  <main class="grid">
    <!-- 3-series line -->
    <section class="card full">
      <h2 class="title">3-Series Line Chart</h2>
      <div id="lineChart" class="chart"></div>
    </section>

    <!-- 2-series bar -->
    <section class="card">
      <h2 class="title">2-Series Bar Chart</h2>
      <div id="barChart" class="chart"></div>
    </section>

    <!-- Pie -->
    <section class="card">
      <h2 class="title">Pie Chart</h2>
      <div id="pieChart" class="chart"></div>
    </section>
  </main>

  <script>
    // ---- Dummy data (renders immediately) ----
    const lineConfig = {
      type: 'line',
      title: { text: 'Page Timing (Dummy)' },
      legend: { draggable: true },
      scaleX: { label: { text: 'Sample #'} },
      scaleY: { label: { text: 'ms' } },
      series: [
        { text: 'start', values: [10, 12, 9, 11, 13, 15, 14] },
        { text: 'end',   values: [120, 130, 115, 140, 150, 160, 145] },
        { text: 'total', values: [110, 118, 106, 129, 137, 145, 131] },
      ]
    };

    const barConfig = {
      type: 'bar',
      title: { text: 'Events per Type (Dummy)' },
      scaleX: { labels: ['mouse','scroll','keyboard','error','enter/leave'] },
      series: [
        { text: 'Today',    values: [15, 7, 9, 1, 6] },
        { text: 'Yesterday',values: [12, 5, 6, 2, 4] }
      ]
    };

    const pieConfig = {
      type: 'pie',
      title: { text: 'Users by Connection Type (Dummy)' },
      series: [
        { text: '4g', values: [60] },
        { text: 'wifi', values: [30] },
        { text: '3g', values: [7] },
        { text: 'other', values: [3] }
      ]
    };

    // Render all three with dummy data
    zingchart.render({ id: 'lineChart', data: lineConfig, height: '100%', width: '100%' });
    zingchart.render({ id: 'barChart',  data: barConfig,  height: '100%', width: '100%' });
    zingchart.render({ id: 'pieChart',  data: pieConfig,  height: '100%', width: '100%' });

    fetch('/api/perf')
      .then(r => r.json())
      .then(rows => {
        // rows: [{start_ms,end_ms,total_ms,...}, ...]
        const start = rows.map(r => r.start_ms || 0);
        const end   = rows.map(r => r.end_ms   || 0);
        const total = rows.map(r => r.total_ms || 0);

        zingchart.exec('lineChart', 'setdata', {
          data: {
            ...lineConfig,
            title: { text: 'Page Timing (Live)' },
            series: [
              { text:'start', values:start },
              { text:'end',   values:end   },
              { text:'total', values:total }
            ]
          }
        });
      })
      .catch(console.error);

  </script>
</body>
</html>
